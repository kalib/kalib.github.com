
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Introdução ao Terraform - Marcelo Cavalcante Rocha ~</title>
  <meta name="author" content="Marcelo Cavalcante Rocha - Kalib">

  
  <meta name="description" content="Uma introdução ao Terraform, da Hashicorp, como robusta e eficiente ferramenta para infraestrutura como código.">
  <meta name="keywords" content="HashiCorp,Linux,OS X, Windows,Devops,Cloud,Docker,Nuvem,Automação,Infraestrutura como código,IAC,Infrastructure as code,Mario">

  <!-- https://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://kalib.github.io/blog/2018/10/29/introducao-ao-terraform/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Marcelo Cavalcante Rocha ~" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at https://google.com/webfonts -->
<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-42903485-1']);
    _gaq.push(['_setDomainName','marcelocavalcante.net']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'https://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:kalib.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
    <li><a href="/">
        <span class="blue_light">
            Marcelo Cavalcante Rocha ~
        </span>
       
           <span class="blue_dark">
             Hacking the damn life...
           </span>
       
    </a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Arquivos</a></li>
  <li><a href="/about">Sobre mim</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Introdução Ao Terraform</h1>
    
    
      <p class="meta">
        








  


<time datetime="2018-10-29T21:35:00-04:00" pubdate data-updated="true">Oct 29<span>th</span>, 2018</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p><img class="center" src="/imgs/terraform-integrations.png" title="'Terraform'" ></p>

<h2>Terraform &ndash; Uma robusta opção para Infraestrutura como Código</h2>

<p><strong>A</strong> Hashicorp é uma empresa de bastante destaque no meio DevOps por ter criado várias soluções de automação, que englobam uma série de funcionalidades, como o <a href="https://packer.io">Packer</a> para criação de imagens de forma automatizada, conforme apresentado nestes dois posts  do blog (<a href="https://blog.marcelocavalcante.net/blog/2018/07/30/automatizando-a-criacao-de-imagens-com-packer/">1</a>, <a href="https://blog.marcelocavalcante.net/blog/2018/08/11/criando-uma-imagem-aws-ec2-com-packer-e-puppet/">2</a>), <a href="https://vagrant.io">Vagrant</a>, para provisionamento simples e rápido de máquinas, <a href="https://vaultproject.io">Vault</a>, para gerenciamento de senhas/segredos (<em>secrets</em>), <a href="https://consul.io">Consul</a>, para descoberta de serviços, <a href="nomadproject.io">Nomad</a>, para agendamento e automação de deployments, e o <a href="https://terraform.io">Terraform</a>, foco principal deste post, uma robusta ferramenta para criação de infraestrutura como código, ou <em>infrastructure as cdode</em>.</p>

<p><strong>C</strong>aso você não possua uma ideia muito clara de qual a idea por trás do conceito de infraestrutura como código, ou mesmo quais as vantagens de se utilizar esta metodologia de gerenciamento/criação de infraestrutura, sugiro que leia meu <a href="https://blog.marcelocavalcante.net/blog/2018/10/22/infraestrutura-como-codigo-com-terraform/">post anterior</a>, no qual explico alguns dos principais benefícios desta prática, bem como uma breve apresentação do Terraform.</p>

<p><strong>D</strong>e forma resumida, o Terraform é uma ferramenta disponível em formatos Open Source ou Enterprise, cujo intuito é permitir a criação de infraestrutura como código, possibilitando o controle de versões. Suporta diversos provedores tais como AWS, OpenStack, Azure, GCP, etc.</p>

<p><strong>U</strong>ma de suas principais características é a idempotência, termo muito utilizado na matemática ou em ciência da computação para indicar a propriedade que algumas operações têm de poderem ser aplicadas várias vezes sem que o valor do resultado se altere após a aplicação inicial. Ou seja, uma vez aplicado o seu código terraform, você poderá aplicá-lo quantas vezes desejar e nenhuma alteração será feita em sua infraestrutura, a menos que você tenha de fato alterado algo em seu código.</p>

<p><strong>O</strong> Terraform utiliza uma linguagem de alto nível e fácil de se reutilizar, uma vez que podemos criar módulos e utilizar estes módulos em diversos projetos distintos, mesmo que tenhamos módulos em repositórios também distintos.</p>

<p><strong>A</strong> ideia de possuir um &ldquo;plano&rdquo; de execução nos ajuda a identificar falhas em nosso código mais rapidamente, bem como prevenir problemas em nossa infraestrutura, visto que podemos ter uma visão geral de tudo o que será aplicado em nossa infra antes mesmo da execução real de nosso código, nos permitindo ter a certeza de que todas as alterações serão de fato intencionais.</p>

<p><strong>S</strong>empre digo que a melhor forma de se aprender uma nova tecnologia é colocando a mão na massa, portanto vamos escrever algumas linhas de código para entendermos as funcionalidades básicas bem como a sintaxe de código utilizada pelo Terraform.</p>

<p><strong>A</strong>ntes de pensarmos em cenários mais complexos devemos entender o básico, no entanto eu sempre gostei de ver algum resultado como forma de ter uma motivação real para meus estudos. Nunca gostei de apenas ler e escrever códigos que não resultam em nada, e acredito que todos devam sentir a mesma insatisfação ao não ter um uso real e prático para o que quer que esteja estudando.</p>

<p><strong>S</strong>eguindo esta ideia, antes de pensarmos em cenários mais complexos, vamos iniciar pelo básico, porém com algum resultado prático. A ideia para este post é termos um jogo clássico do Mario rodando em um container Docker que seja acessível através de nosso browser.</p>

<h2>Instalação</h2>

<p><strong>P</strong>ara este post precisaremos ter três aplicativos instalados:</p>

<ol>
<li>Um navegador ou browser qualquer; (Imagino que você já tenha algum&hellip;)</li>
<li>Docker;</li>
<li>Terraform</li>
</ol>


<h3>Docker</h3>

<p><strong>O</strong> processo de instalação do Docker varia de acordo com o seu sistema operacional. Caso queira maiores detalhes sobre sua instalação, bem como uma explicação introdutória de como ele funciona, você pode visitar <a href="https://blog.marcelocavalcante.net/blog/2015/08/20/docker-uma-alternativa-elegante-para-containers-no-linux/">este outro post</a>, embora você não precise ter nenhum conhecimento sobre Docker para seguir as instruções deste tutorial, visto que utilizaremos o Terraform para criar nosso container.</p>

<p><strong>N</strong>o <em>Archlinux</em> a instalação pode ser feita através do pacman:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pacman install docker</span></code></pre></td></tr></table></div></figure>


<p><strong>N</strong>o <em>Windows</em> a instalação pode ser feita através do binário disponível no site oficial: (<a href="https://store.docker.com/editions/community/docker-ce-desktop-windows">https://store.docker.com/editions/community/docker-ce-desktop-windows</a>)</p>

<p><strong>N</strong>o <em>OS X</em>, você também pode baixar o binário diretamente no site oficial, (<a href="https://store.docker.com/editions/community/docker-ce-desktop-mac">https://store.docker.com/editions/community/docker-ce-desktop-mac</a>) ou através do brew:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brew install docker</span></code></pre></td></tr></table></div></figure>


<h3>Terraform</h3>

<p><strong>A</strong> instalação do Terraform é tão simples quanto a do Docker.</p>

<p><strong>N</strong>o <em>Archlinux</em> a instalação pode ser feita através do pacman:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pacman -S terraform</span></code></pre></td></tr></table></div></figure>


<p><strong>N</strong>o <em>Windows</em> e no <em>OS X</em> a instalação pode ser feita através do binário disponível no site oficial do Terraform: (<a href="https://www.terraform.io/downloads.html">https://www.terraform.io/downloads.html</a>)</p>

<p><strong>O</strong>utra opção para OS X é através do brew:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brew install terraform</span></code></pre></td></tr></table></div></figure>


<h2>Verificando a instalação</h2>

<p><strong>U</strong>ma vez que você tenha instalado ambos, certifique-se de que a instalação foi bem sucedida e de que o serviço Docker esteja rodando em seu sistema. Para isto, abra algum terminal, console ou prompt do CMD (para usuários Windows) e digite o seguinte:</p>

<p>1- Para termos certeza de que o Terraform está instalado e funcionando:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>terraform -version</span></code></pre></td></tr></table></div></figure>


<p>Você deverá receber algum resultado com a versão do seu Terraform, similar a este:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Terraform v0.11.10</span></code></pre></td></tr></table></div></figure>


<p>2- Para termos certeza de que o Docker está devidamente instalado e rodando, digite:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>docker ps</span></code></pre></td></tr></table></div></figure>


<p>Você deverá receber algum resultado parecido com o seguinte:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span></code></pre></td></tr></table></div></figure>


<p><strong>N</strong>ão se assuste ou dê importância para este resultado do comando Docker, ele apenas indica o status atual de seu Docker, informando se você possui algum container rodando ou não. Caso você tenha acabado de instalar o mesmo ou iniciado o serviço do Docker, você provavelmente não terá nenhum container rodando.</p>

<p><strong>C</strong>aso o retorno de seu Docker ou Terraform não seja similar aos que apresentei acima, verifique se a instalação foi realmente bem sucedida ou, no caso do Docker, verifique se o mesmo está rodando, afinal ele não apenas precisa ser instalado, mas precisa estar rodando, diferentemente do Terraform que apenas precisa ser instalado.</p>

<h2>Iniciando nosso projeto</h2>

<p><img class="center" src="/imgs/mariodocker.png" title="'Super Mario'" ></p>

<h3>Escopo</h3>

<p><strong>O</strong> primeiro passo de qualquer projeto é identificar alguma espécie de esboço ou escopo para o mesmo.</p>

<p><strong>O</strong> que queremos para o nosso projeto é:</p>

<ol>
<li>Ter um jogo web do Mario;</li>
<li>Queremos que ele rode em um container, pois queremos uma aplicação em uma infraestrutura moderna e que possa ser capaz de rodar em qualquer local, seja em um servidor físico local, uma VM ou mesmo um provedor na nuvem, como AWS, GCP, Azure, etc.;</li>
<li>Como não sabemos onde ou como iremos fazer o deployment deste container, queremos fazer com que seja algo automatizado e portável para facilitar futuros planos, portanto queremos criar este container com o Terraform, para que possamos gerenciar nosso código, versionar, etc.</li>
<li>Não escreveremos a aplicação em si. O jogo do Mario já existe e uma imagem para Docker já está disponível para o mesmo através do seguinte link: (<a href="https://hub.docker.com/r/pengbai/docker-supermario/">https://hub.docker.com/r/pengbai/docker-supermario/</a>) (Mas nós não precisamos nos precoupar com isto agora, pois o Terraform vai cuidar de baixar a imagem para nós. ;])</li>
<li>A aplicação deverá estar acessível via browser local para que possamos ao menos garantir que o jogo está de fato funcionando.</li>
</ol>


<p><strong>E</strong>ste será o nosso escopo básico, portanto vamos começar nosso código.</p>

<h3>Projeto</h3>

<p><strong>O</strong> recurso mais básico em um código ou módulo Terraform é o <em>resource</em>, ou recurso. O Terraform suporta centenas de recursos diferentes, dentre eles o <em>docker_image</em>, que será o recurso de que precisaremos inicialmente.</p>

<p><strong>A</strong> partir deste momento não mais utilizarei a palavra recurso. Uma vez que o Terraform chama os recursos de <em>resources</em>, devemos nos acostumar com sua nomenclatura.</p>

<p><strong>A</strong>ntes de mais nada, vamos criar um diretório para nosso projeto. Chamaremos nosso projeto de Marioweb, visto que se trata de uma versao open source do jogo Mario.</p>

<p><strong>A</strong>qui estarei criando o diretório via linha de comando, mas sinta-se livre para criar um diretório da forma que você preferir. Após criar o diretório, com algum terminal ou console aberto (ou prompt do CMD para usuários do Windows), navegue até este diretório recém criado:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir marioweb
</span><span class='line'>
</span><span class='line'>$ cd marioweb</span></code></pre></td></tr></table></div></figure>


<p><strong>D</strong>entro do diretório <em>marioweb</em> crie um novo arquivo chamado <em>main.tf</em>.</p>

<p><strong>P</strong>ara manter um padrão, os arquivos de código do Terraform costumam utilizar o sufixo/extensão .tf e o principal arquivo em módulos ou projetos Terraform costuma se chamar <em>main.tf</em>, por se tratar do arquivo principal do módulo ou projeto.</p>

<p><strong>P</strong>ara criar este arquivo você poderá utilizar qualquer editor de textos de sua escolha: vim, emacs, vi, notepad, notepad++, sublime, atom, etc.</p>

<p><strong>E</strong>m nosso arquivo <em>main.tf</em> insira o seguinte conteúdo por enquanto:</p>

<p><strong>main.tf</strong></p>

<figure class='code'><figcaption><span>main.tf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="c"># Baixar a imagem do Projeto Docker-SuperMario</span>
</span><span class='line'><span class="n">resource</span> <span class="s">&quot;docker_image&quot;</span> <span class="s">&quot;image_id&quot;</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;pengbai/docker-supermario:latest&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>O</strong> que temos no bloco de código acima:</p>

<ol>
<li>A primeira linha é apenas um comentário. Como boa prática, é importante termos comentários ao longo de nosso código para descrever o que pretendemos com aquele determinado trecho de código. E por hora, o que pretendemos é exatamente apenas isso: <em>Baixar a imagem do Projeto Docker-SuperMario</em> para nosso ambiente.</li>
<li>Na linha 2 estamos especificando que queremos utilizar um <em>resource</em>. Cada <em>resource</em> no Terraform leva dois parâmetros, sendo um deles o <em>tipo de resource</em> e o outro um <em>nome qualquer</em> para este resource. Como dito antes, este trecho de código pretende baixar a imagem do projeto SuperMario, portanto precisamos do tipo de <em>resource</em> chamado <em>docker_image</em>. Este é apenas um dos milhares de <em>resources</em> existentes para o Terraform. Em seguida estamos dando o nome <em>image_id</em> para nosso <em>resource</em> de tipo <em>docker_image</em>. O nome poderia ser qualquer um, até mesmo <em>minha_imagem_do_coracao</em>, mas para ficar mais descritiva e mantendo boas práticas, utilizarei <em>image_id</em>. Uma vez que identificamos o tipo de <em>resource</em> e o nome que queremos dar para ele, devemos encerrar a linha abrindo o bloco de código no qual listaremos os atributos deste <em>resource</em>. Para isto, utilizaremos um <em>{</em> para abrir este bloco.</li>
<li>Na linha 3 começamos a definir os atributos do nosso <em>resource</em>. A documentação do Terraform é excelente e lista todos os <em>resources</em> suportados, bem como todos os <em>atributos</em> suportados por cada <em>resource</em>. Neste caso, o único atributo que precisamos no momento é o <em>name</em>, ou nome da imagem que desejamos baixar. Em seguida, indicamos qual o nome da imagem desejada. Por padrão, o Docker adota a nomenclatura <em>&lt;REPOSITÓRIO/IMAGEM:TAG></em> para indicar a imagem desejada. Em nosso caso, o repositório onde a imagem se encontra se chama <em>pengbai</em> e a imagem em si é chamada de <em>docker-supermario</em>, portanto teremos: <em>name = &ldquo;pengbai/super-mario&rdquo;</em>. A <em>tag</em> não é obrigatória. Mas como desejo garantir que utilizaremos sempre a imagem mais recente, utilizarei a tag <em>latest</em> (última).</li>
<li>Uma vez que concluímos a definição de nosso <em>resource</em>, podemos fechar o nosso bloco de código para o mesmo utilizando um <em>}</em> na linha 4.</li>
</ol>


<p><strong>A</strong>gora que temos o início de nosso código, já podemos começar a testá-lo.</p>

<p><strong>D</strong>e volta ao nosso terminal/console, vamos iniciar o nosso ambiente Terraform para este projeto utilizando o comando <em>terraform init</em>. Este comando inicia nosso ambiente e baixa os plugins necessários para nosso projeto. No nosso caso, o Terraform baixará os plugins necessários para que nosso código possa lidar com o Docker.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">$ terraform init</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Initializing provider plugins...</span>
</span><span class='line'><span class="l-Scalar-Plain">- Checking for available provider plugins on https://releases.hashicorp.com...</span>
</span><span class='line'><span class="l-Scalar-Plain">- Downloading plugin for provider &quot;docker&quot; (1.1.0)...</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">The following providers do not have any version constraints in configuration,</span>
</span><span class='line'><span class="l-Scalar-Plain">so the latest version was installed.</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">To prevent automatic upgrades to new major versions that may contain breaking</span>
</span><span class='line'><span class="l-Scalar-Plain">changes, it is recommended to add version = &quot;...&quot; constraints to the</span>
</span><span class='line'><span class="l-Scalar-Plain">corresponding provider blocks in configuration, with the constraint strings</span>
</span><span class='line'><span class="l-Scalar-Plain">suggested below.</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">* provider.docker</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">version = &quot;~&gt; 1.1&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Terraform has been successfully initialized!</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">You may now begin working with Terraform. Try running &quot;terraform plan&quot; to see</span>
</span><span class='line'><span class="l-Scalar-Plain">any changes that are required for your infrastructure. All Terraform commands</span>
</span><span class='line'><span class="l-Scalar-Plain">should now work.</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">If you ever set or change modules or backend configuration for Terraform,</span>
</span><span class='line'><span class="l-Scalar-Plain">rerun this command to reinitialize your working directory. If you forget, other</span>
</span><span class='line'><span class="l-Scalar-Plain">commands will detect it and remind you to do so if necessary.</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>S</strong>e você recebeu um retorno parecido com o meu, significa que tudo está como deveria e que seu projeto foi iniciado com sucesso. Caso você liste os arquivos e diretórios ocultos de seu diretório, perceberá que ao rodar o comando <em>terraform init</em>, um diretório oculto chamado <em>terraform</em> foi criado. É nele que ficarão as informações que o Terraform precisa para executar corretamente o seu código, incluindo os plugins que ele necessita. No nosso caso, o plugin para o Docker estará lá.</p>

<p><strong>N</strong>osso próximo passo será executar o <em>planejamento</em> de nosso código. Ao rodar o <em>planejamento</em> o terraform listará exatamente tudo o que fará caso nosso código seja de fato executado. Novamente em nosso console/terminal, execute <em>terraform plan</em>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">$ terraform plan</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Refreshing Terraform state in-memory prior to plan...</span>
</span><span class='line'><span class="l-Scalar-Plain">The refreshed state will be used to calculate this plan, but will not be</span>
</span><span class='line'><span class="l-Scalar-Plain">persisted to local or remote state storage.</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">ATENÇÃO AQUI</span><span class="p-Indicator">:</span>
</span><span class='line'><span class="l-Scalar-Plain">------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">An execution plan has been generated and is shown below.</span>
</span><span class='line'><span class="l-Scalar-Plain">Resource actions are indicated with the following symbols</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">+ create</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Terraform will perform the following actions</span><span class="p-Indicator">:</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">+ docker_image.image_id</span>
</span><span class='line'>      <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span>     <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">latest</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>   <span class="s">&quot;pengbai/docker-supermario:latest&quot;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Plan</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1 to add, 0 to change, 0 to destroy.</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Note</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">You didn&#39;t specify an &quot;-out&quot; parameter to save this plan, so Terraform</span>
</span><span class='line'><span class="l-Scalar-Plain">can&#39;t guarantee that exactly these actions will be performed if</span>
</span><span class='line'><span class="s">&quot;terraform</span><span class="nv"> </span><span class="s">apply&quot;</span> <span class="l-Scalar-Plain">is subsequently run.</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>C</strong>aso você tenha recebido um retorno similar a este, significa que tudo parece correto em seu código e que apenas uma ação será executada, conforme descrito no resumo do plano ao final:</p>

<p><em>Plan: 1 to add, 0 to change, 0 to destroy.</em></p>

<p><strong>O</strong>u seja: Plano: 1 a adicionar, 0 a alterar, 0 a destruir.</p>

<p><strong>E</strong>xatamente o que queremos.</p>

<p><strong>C</strong>aso você tenha recebido uma mensagem de erro, significa que algo em seu código está errado. Por exemplo, se ao invés de utilizarmos <em>docker_image</em> como tipo de resource, utilizarmos <em>docker_images</em>, o resultado de meu <em>terraform plan</em> seria o seguinte:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">$ terraform plan</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Error</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">docker_images.image_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Provider doesn&#39;t support resource</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">docker_images</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>A</strong> mensagem geralmente é clara e nos indica onde está o erro. No caso acima, o Terraform nos diz que o resource <em>docker_images</em> não é suportado. Se checarmos a documentação do Terraform, veremos que o nome correto do <em>resource</em> é <em>docker_image</em> (no singular).</p>

<p><strong>U</strong>ma vez que nosso plano foi executado sem erros, chegou a hora de aplicarmos nosso projeto.</p>

<p><strong>E</strong>xecute o seu código através do comando <em>terraform apply</em>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">$ terraform apply</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">An execution plan has been generated and is shown below.</span>
</span><span class='line'><span class="l-Scalar-Plain">Resource actions are indicated with the following symbols</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">+ create</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Terraform will perform the following actions</span><span class="p-Indicator">:</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">+ docker_image.image_id</span>
</span><span class='line'>      <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span>     <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">latest</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>   <span class="s">&quot;pengbai/docker-supermario:latest&quot;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Plan</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1 to add, 0 to change, 0 to destroy.</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Do you want to perform these actions?</span>
</span><span class='line'>  <span class="l-Scalar-Plain">Terraform will perform the actions described above.</span>
</span><span class='line'>  <span class="l-Scalar-Plain">Only &#39;yes&#39; will be accepted to approve.</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">Enter a value</span><span class="p-Indicator">:</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>R</strong>epare que mesmo ao utilizar <em>apply</em> ao invés de <em>plan</em>, uma espécie de planejamento também foi realizado antes da aplicação propriamente dita. O Terraform avaliou o código e nos indicou o que será realizado, perguntando-nos ao final se queremos ou não seguir com a execução. Caso tudo nos pareça correto, basta digitarmos <em>yes</em> e pressionar Enter novamente para que ele siga com a execução de fato.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'>  <span class="l-Scalar-Plain">Enter a value</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yes</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">docker_image.image_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Creating...</span>
</span><span class='line'>  <span class="l-Scalar-Plain">latest</span><span class="p-Indicator">:</span> <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;&lt;computed&gt;&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>   <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;pengbai/docker-supermario:latest&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_image.image_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Still creating... (10s elapsed)</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_image.image_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Still creating... (20s elapsed)</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_image.image_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Still creating... (30s elapsed)</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_image.image_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Still creating... (40s elapsed)</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_image.image_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Creation complete after 47s (ID</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sha256:49beaba1c5cc49d2fa424ac03a15b0e7...9c3d62pengbai/docker-supermario:latest)</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Apply complete! Resources</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1 added, 0 changed, 0 destroyed.</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>A</strong>ssim como no <em>plan</em>, o Terraform ao final nos deu um breve relatório do que foi feito:</p>

<p><em>Apply complete! Resources: 1 added, 0 changed, 0 destroyed.</em></p>

<p><strong>O</strong>u seja: Aplicação completa! Recursos: 1 adicionado, 0 alterados, 0 destruídos.</p>

<p><strong>S</strong>e quisermos ter certeza de que de fato o Terraform baixou a imagem Docker de que precisamos, basta digitarmos o comando do Docker que lista as imagens que possuímos em nosso ambiente. A nossa nova imagem do supermario deverá estar lá. Digite <em>docker images</em>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">$ docker images</span>
</span><span class='line'><span class="l-Scalar-Plain">REPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE</span>
</span><span class='line'><span class="l-Scalar-Plain">pengbai/docker-supermario   latest              49beaba1c5cc        4 months ago        686MB</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Ó</strong>timo, nossa imagem está presente em nosso ambiente.</p>

<p><strong>O</strong> Terraform também nos permite saber o que estamos utilizando em termos de <em>resources</em> através do comando <em>terraform show</em>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">$ terraform show</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">docker_image.image_id</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">id = sha256:49beaba1c5cc49d2fa424ac03a15b0e761f637e835c1ed4d8108cc247a9c3d62pengbai/docker-supermario:latest</span>
</span><span class='line'>  <span class="l-Scalar-Plain">latest = sha256:49beaba1c5cc49d2fa424ac03a15b0e761f637e835c1ed4d8108cc247a9c3d62</span>
</span><span class='line'>  <span class="l-Scalar-Plain">name = pengbai/docker-supermario:latest</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>V</strong>oltemos ao nosso código. Agora que já conseguimos fazer com que nosso código baixe a imagem que utilizaremos via Docker, chegou a hora de fazer algo com ela. Precisamos realizar o <em>deployment</em> da mesma em um container, certo?!</p>

<p><strong>V</strong>amos adicionar mais um <em>resource</em> em nosso código, desta vez um <em>resource</em> de tipo <em>docker_container</em>. Como o nome já diz, este <em>resource</em> lida com o container em si, e não mais apenas com a imagem.</p>

<p><strong>S</strong>eu código agora deverá estar da seguinte forma:</p>

<figure class='code'><figcaption><span>main.tf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="c"># Baixar a imagem do Projeto Docker-SuperMario</span>
</span><span class='line'><span class="n">resource</span> <span class="s">&quot;docker_image&quot;</span> <span class="s">&quot;image_id&quot;</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;pengbai/docker-supermario:latest&quot;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Inicia o Container</span>
</span><span class='line'><span class="n">resource</span> <span class="s">&quot;docker_container&quot;</span> <span class="s">&quot;container_id&quot;</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;supermario&quot;</span>
</span><span class='line'>  <span class="n">image</span> <span class="o">=</span> <span class="s">&quot;${docker_image.image_id.latest}&quot;</span>
</span><span class='line'>  <span class="n">ports</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">internal</span> <span class="o">=</span> <span class="s">&quot;8080&quot;</span>
</span><span class='line'>    <span class="n">external</span> <span class="o">=</span> <span class="s">&quot;80&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>I</strong>gnorando as linhas já descritas anteriormente, vamos descrever as novas linhas de nosso código:</p>

<ol>
<li>Na linha 6 inserimos apenas mais um comentário, indicando que ali começaremos a descrever o código que criará nosso Container.</li>
<li>Na linha 7 indicamos que queremos mais um <em>resource</em>. Desta vez o tipo de <em>resource</em> que queremos é o <em>docker_container</em>, indicando também que queremos dar o nome <em>container_id</em> a este <em>resource</em>. Novamente, ao fim da linha, abriremos o bloco de código para este <em>resource</em> com uma <em>{</em>.</li>
<li>Dentro de nosso bloco, na linha 8, começaremos a listar os atributos deste <em>resource</em>. O primeiro atributo que listaremos é o <em>name</em>, e para ele daremos o nome <em>supermario</em>.</li>
<li>Na linha 9 indicaremos o atributo <em>image</em> e utilizaremos nossa primeira interpolação, onde reutilizaremos valores de outra parte de nosso código como se fossem variáveis. Em nosso <em>resource</em> anterior, <em>docker_image</em>, demos um nome <em>image_id</em> que será utilizado agora. Incluiremos também a tag <em>latest</em>, pois, conforme pudemos ver na saída de nosso comando <em>terraform show</em>, esta foi a tag utilizada pelo terraform para identificar o último status daquele <em>resource</em>. Portanto, aqui utilizaremos a interpolação inserindo o que queremos entre <em>{}</em> seguidas do símbolo <em>$</em>, conforme prega a sintaxe do Terraform para interpolação de valores, ficando o seguinte: <em>${docker_image.image_id.latest}</em>, onde <em>docker_image</em> é o tipo de resource de onde queremos o valor, <em>image_id</em> é o nome deste resource e <em>latest</em> é a tag para indicar que queremos o último valor daquele <em>resource</em>. O único motivo pelo qual temos um tipo de <em>resource</em> e um nome de <em>resource</em> é facilitar a identificação quando possuímos diversos <em>resources</em> do mesmo tipo. Imagine um projeto em que utilizaremos 5 imagens diferentes do Docker. Teríamos 5 <em>resources</em> do tipo <em>docker_image</em>, porém cada um deles teria um nome diferente, certo?!</li>
<li>Na linha 10 de nosso código iniciamos o bloco de portas, afinal, toda aplicação roda em uma porta específica e com containers não seria diferente.</li>
<li>Nas linhas 11 e 12 indicamos os valores para portas <em>intern</em> e <em>externß</em>, onde a porta <em>intern</em> será a porta utilizada pela aplicação internamente no container, e <em>extern</em> será a porta que o Docker irá mapear em nosso sistema local para que possamos acessar a nossa aplicação. Portanto, em nosso exemplo, a aplicação supermario irá rodar na porta <em>8080</em> internamente no container, e a porta 80 será mapeada para que possamos acessá-la de nosso navegador local.</li>
<li>Nas linhas 13 e 14 apenas fecharemos os dois blocos de código que criamos, sendo estes o bloco <em>ports</em> e o bloco <em>resource</em> do <em>docker_container</em>.</li>
</ol>


<p><strong>N</strong>ovamente, vamos planejar nosso projeto com <em>terraform plan</em>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">$ terraform plan</span>
</span><span class='line'><span class="l-Scalar-Plain">Refreshing Terraform state in-memory prior to plan...</span>
</span><span class='line'><span class="l-Scalar-Plain">The refreshed state will be used to calculate this plan, but will not be</span>
</span><span class='line'><span class="l-Scalar-Plain">persisted to local or remote state storage.</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">docker_image.image_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Refreshing state... (ID</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sha256:49beaba1c5cc49d2fa424ac03a15b0e7...9c3d62pengbai/docker-supermario:latest)</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">An execution plan has been generated and is shown below.</span>
</span><span class='line'><span class="l-Scalar-Plain">Resource actions are indicated with the following symbols</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">+ create</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Terraform will perform the following actions</span><span class="p-Indicator">:</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">+ docker_container.container_id</span>
</span><span class='line'>      <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span>               <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">attach</span><span class="p-Indicator">:</span>           <span class="s">&quot;false&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">bridge</span><span class="p-Indicator">:</span>           <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">container_logs</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">exit_code</span><span class="p-Indicator">:</span>        <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">gateway</span><span class="p-Indicator">:</span>          <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span>            <span class="s">&quot;sha256:49beaba1c5cc49d2fa424ac03a15b0e761f637e835c1ed4d8108cc247a9c3d62&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ip_address</span><span class="p-Indicator">:</span>       <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ip_prefix_length</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">log_driver</span><span class="p-Indicator">:</span>       <span class="s">&quot;json-file&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">logs</span><span class="p-Indicator">:</span>             <span class="s">&quot;false&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">must_run</span><span class="p-Indicator">:</span>         <span class="s">&quot;true&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>             <span class="s">&quot;supermario&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">network_data.#</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.#</span><span class="p-Indicator">:</span>          <span class="s">&quot;1&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.0.external</span><span class="p-Indicator">:</span> <span class="s">&quot;80&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.0.internal</span><span class="p-Indicator">:</span> <span class="s">&quot;8080&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.0.ip</span><span class="p-Indicator">:</span>       <span class="s">&quot;0.0.0.0&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.0.protocol</span><span class="p-Indicator">:</span> <span class="s">&quot;tcp&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">restart</span><span class="p-Indicator">:</span>          <span class="s">&quot;no&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">rm</span><span class="p-Indicator">:</span>               <span class="s">&quot;false&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">start</span><span class="p-Indicator">:</span>            <span class="s">&quot;true&quot;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Plan</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1 to add, 0 to change, 0 to destroy.</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Note</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">You didn&#39;t specify an &quot;-out&quot; parameter to save this plan, so Terraform</span>
</span><span class='line'><span class="l-Scalar-Plain">can&#39;t guarantee that exactly these actions will be performed if</span>
</span><span class='line'><span class="s">&quot;terraform</span><span class="nv"> </span><span class="s">apply&quot;</span> <span class="l-Scalar-Plain">is subsequently run.</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>R</strong>epare que desta vez apenas 1 ação será executada: a criação do container. Não estamos mais recebendo as informações referentes à ação de baixar a imagem. O motivo para isto é a propriedade de idempotência que citei anteriormente. O Terraform sabe que a imagem já foi baixada, portanto a mesma não precisa ser baixada novamente, a menos que tivéssemos mudado a versão da mesma, nome, repositório, etc.</p>

<p><strong>U</strong>ma vez que o plano esteja de acordo com o que queremos, podemos aplicar nosso código com <em>terraform apply</em>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">$ terraform apply</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_image.image_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Refreshing state... (ID</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sha256:49beaba1c5cc49d2fa424ac03a15b0e7...9c3d62pengbai/docker-supermario:latest)</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">An execution plan has been generated and is shown below.</span>
</span><span class='line'><span class="l-Scalar-Plain">Resource actions are indicated with the following symbols</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">+ create</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Terraform will perform the following actions</span><span class="p-Indicator">:</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">+ docker_container.container_id</span>
</span><span class='line'>      <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span>               <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">attach</span><span class="p-Indicator">:</span>           <span class="s">&quot;false&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">bridge</span><span class="p-Indicator">:</span>           <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">container_logs</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">exit_code</span><span class="p-Indicator">:</span>        <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">gateway</span><span class="p-Indicator">:</span>          <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span>            <span class="s">&quot;sha256:49beaba1c5cc49d2fa424ac03a15b0e761f637e835c1ed4d8108cc247a9c3d62&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ip_address</span><span class="p-Indicator">:</span>       <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ip_prefix_length</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">log_driver</span><span class="p-Indicator">:</span>       <span class="s">&quot;json-file&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">logs</span><span class="p-Indicator">:</span>             <span class="s">&quot;false&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">must_run</span><span class="p-Indicator">:</span>         <span class="s">&quot;true&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>             <span class="s">&quot;supermario&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">network_data.#</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.#</span><span class="p-Indicator">:</span>          <span class="s">&quot;1&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.0.external</span><span class="p-Indicator">:</span> <span class="s">&quot;80&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.0.internal</span><span class="p-Indicator">:</span> <span class="s">&quot;8080&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.0.ip</span><span class="p-Indicator">:</span>       <span class="s">&quot;0.0.0.0&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.0.protocol</span><span class="p-Indicator">:</span> <span class="s">&quot;tcp&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">restart</span><span class="p-Indicator">:</span>          <span class="s">&quot;no&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">rm</span><span class="p-Indicator">:</span>               <span class="s">&quot;false&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">start</span><span class="p-Indicator">:</span>            <span class="s">&quot;true&quot;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Plan</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1 to add, 0 to change, 0 to destroy.</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Do you want to perform these actions?</span>
</span><span class='line'>  <span class="l-Scalar-Plain">Terraform will perform the actions described above.</span>
</span><span class='line'>  <span class="l-Scalar-Plain">Only &#39;yes&#39; will be accepted to approve.</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">Enter a value</span><span class="p-Indicator">:</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>M</strong>ais uma vez ele nos dá uma visão geral do que será feito e nos perguntará se queremos prosseguir. Digite <em>yes</em> e pressione Enter novamente.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">Enter a value</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yes</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">docker_container.container_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Creating...</span>
</span><span class='line'><span class="l-Scalar-Plain">attach</span><span class="p-Indicator">:</span>           <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;false&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">bridge</span><span class="p-Indicator">:</span>           <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;&lt;computed&gt;&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">container_logs</span><span class="p-Indicator">:</span>   <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;&lt;computed&gt;&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">exit_code</span><span class="p-Indicator">:</span>        <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;&lt;computed&gt;&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">gateway</span><span class="p-Indicator">:</span>          <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;&lt;computed&gt;&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span>            <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;sha256:49beaba1c5cc49d2fa424ac03a15b0e761f637e835c1ed4d8108cc247a9c3d62&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">ip_address</span><span class="p-Indicator">:</span>       <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;&lt;computed&gt;&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">ip_prefix_length</span><span class="p-Indicator">:</span> <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;&lt;computed&gt;&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">log_driver</span><span class="p-Indicator">:</span>       <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;json-file&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">logs</span><span class="p-Indicator">:</span>             <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;false&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">must_run</span><span class="p-Indicator">:</span>         <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;true&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>             <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;supermario&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">network_data.#</span><span class="p-Indicator">:</span>   <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;&lt;computed&gt;&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">ports.#</span><span class="p-Indicator">:</span>          <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;1&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">ports.0.external</span><span class="p-Indicator">:</span> <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;80&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">ports.0.internal</span><span class="p-Indicator">:</span> <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;8080&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">ports.0.ip</span><span class="p-Indicator">:</span>       <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;0.0.0.0&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">ports.0.protocol</span><span class="p-Indicator">:</span> <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;tcp&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">restart</span><span class="p-Indicator">:</span>          <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;no&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">rm</span><span class="p-Indicator">:</span>               <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;false&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">start</span><span class="p-Indicator">:</span>            <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;true&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_container.container_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Creation complete after 1s (ID</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">8c9d35eac2fcdc0c7e530567323167b82e72f33d4645abf20685b99d802e2359)</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Apply complete! Resources</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1 added, 0 changed, 0 destroyed.</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>C</strong>onforme o esperado: Aplicaçao completa! <em>Resources</em>: 1 adicionado, 0 alterados, 0 destruídos.</p>

<p><strong>M</strong>ais uma vez podemos verificar se de fato tudo funcionou como o esperado através do Docker. Desta vez, não queremos apenas baixar uma imagem Docker, mas sim criar um container com a mesma abrindo portas específicas que serão mapeadas entre nosso sistema local e nosso container. Execute agora <em>docker ps</em> para ver os containers que estão rodando neste momento:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">docker ps</span>
</span><span class='line'><span class="l-Scalar-Plain">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                  NAMES</span>
</span><span class='line'><span class="l-Scalar-Plain">8c9d35eac2fc        49beaba1c5cc        &quot;catalina.sh run&quot;   2 minutes ago       Up 2 minutes        0.0.0.0:80-&gt;8080/tcp   supermario</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>C</strong>omo podemos ver, temos um container rodando. Podemos até ver que existe um mapeamento de portas: <em>80->8080</em></p>

<p><strong>N</strong>ão está convencido ainda?</p>

<p><strong>A</strong>bra seu navegador e acesse o seguinte endereço: <em>localhost:80</em></p>

<p><strong>C</strong>aso o seu resultado seja algo parecido com a imagem, significa que seu código funcionou conforme o esperado.</p>

<p><img class="center" src="/imgs/mariodocker.png" title="'Super Mario'" ></p>

<p><strong>O</strong> terraform também nos permite destruir a nossa infraestrutura com o comando <em>terraform destroy</em>. Da mesma forma que o <em>apply</em>, o comando <em>destroy</em> também lhe dará uma prévia de o que será destruído e lhe pedirá par aconfirmar com um <em>yes</em> ou <em>no</em>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">$ terraform destroy</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_image.image_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Refreshing state... (ID</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sha256:49beaba1c5cc49d2fa424ac03a15b0e7...9c3d62pengbai/docker-supermario:latest)</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_container.container_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Refreshing state... (ID</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">8c9d35eac2fcdc0c7e530567323167b82e72f33d4645abf20685b99d802e2359)</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">An execution plan has been generated and is shown below.</span>
</span><span class='line'><span class="l-Scalar-Plain">Resource actions are indicated with the following symbols</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">destroy</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Terraform will perform the following actions</span><span class="p-Indicator">:</span>
</span><span class='line'>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker_container.container_id</span>
</span><span class='line'>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker_image.image_id</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Plan</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0 to add, 0 to change, 2 to destroy.</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Do you really want to destroy all resources?</span>
</span><span class='line'>  <span class="l-Scalar-Plain">Terraform will destroy all your managed infrastructure, as shown above.</span>
</span><span class='line'>  <span class="l-Scalar-Plain">There is no undo. Only &#39;yes&#39; will be accepted to confirm.</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">Enter a value</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yes</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">docker_container.container_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Destroying... (ID</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">8c9d35eac2fcdc0c7e530567323167b82e72f33d4645abf20685b99d802e2359)</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_container.container_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Destruction complete after 0s</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_image.image_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Destroying... (ID</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sha256:49beaba1c5cc49d2fa424ac03a15b0e7...9c3d62pengbai/docker-supermario:latest)</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_image.image_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Destruction complete after 2s</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Destroy complete! Resources</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2 destroyed.</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>C</strong>omo podemos ver, o terraform destruiu dois <em>resources</em>, nosso container e nossa imagem. Você poderá confirmar isto tentando acessar novamente o jogo pelo seu navegador ou mesmo através dos comandos <em>docker images</em> e <em>docker ls</em> para ver que tanto o container quanto a imagem foram removidos de nosso sistema:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">$ docker ps</span>
</span><span class='line'><span class="l-Scalar-Plain">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">$ docker images</span>
</span><span class='line'><span class="l-Scalar-Plain">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>D</strong>e volta ao nosso código, vamos incrementá-lo apenas um pouco mais.</p>

<p><strong>O</strong> terraform nos permite especificar também <em>outputs</em>, ou saídas que nos serão apresentadas ao executarmos nosso código. Tratam-se de informações que podem nos ser úteis.</p>

<p><strong>P</strong>or exemplo, supomos que ao executar nosso código, desejamos que o terraform nos informe o IP do container que foi criado e o nome do mesmo, nosso código agora ficaria assim:</p>

<figure class='code'><figcaption><span>main.tf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="c"># Baixar a imagem do Projeto Docker-SuperMario</span>
</span><span class='line'><span class="n">resource</span> <span class="s">&quot;docker_image&quot;</span> <span class="s">&quot;image_id&quot;</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;pengbai/docker-supermario:latest&quot;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Inicia o Container</span>
</span><span class='line'><span class="n">resource</span> <span class="s">&quot;docker_container&quot;</span> <span class="s">&quot;container_id&quot;</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;supermario&quot;</span>
</span><span class='line'>  <span class="n">image</span> <span class="o">=</span> <span class="s">&quot;${docker_image.image_id.latest}&quot;</span>
</span><span class='line'>  <span class="n">ports</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">internal</span> <span class="o">=</span> <span class="s">&quot;8080&quot;</span>
</span><span class='line'>    <span class="n">external</span> <span class="o">=</span> <span class="s">&quot;80&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Nos informa o ip e nome do container criado</span>
</span><span class='line'><span class="n">output</span> <span class="s">&quot;Endereco IP&quot;</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">value</span> <span class="o">=</span> <span class="s">&quot;${docker_container.container_id.ip_address}&quot;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">output</span> <span class="s">&quot;Nome do Container&quot;</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">value</span> <span class="o">=</span> <span class="s">&quot;${docker_container.container_id.name}&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>N</strong>ovamente, ignorando o código que já descrevemos anteriormente, teremos:</p>

<ol>
<li>Na linha 16 inserimos mais um comentário.</li>
<li>Na linha 17 especificamos que desta vez queremos um <em>output</em>, e não mais um <em>resource</em>. Da mesma forma que fizemos com <em>resources</em>, vamos dar um nome a este <em>output</em>, de forma que possamos facilmente identificá-lo posteriormente. No caso, vamos chamar nosso <em>output</em> de <em>Endereco IP</em>. Em seguida abriremos o bloco de código para este <em>output</em> novamente com <em>{</em>.</li>
<li>Na linha 18 daremos o <em>value</em> ou valor deste output. Novamente utilizaremos interpolação de valores para pegar este valor de nossos <em>resources</em>. Para conseguirmos o endereço ip do container, utilizaremos o atributo <em>ip_address</em>, que é um atributo descrito na documentação do Terraform como parte integrante do resource de tipo <em>docker_container</em>. Portanto, nosso <em>value</em> será: ${docker_container.container_id.ip_address}.</li>
<li>Na linha 19, apenas fechamos o bloco deste <em>output</em>.</li>
<li>Na linha 21 iniciamos nosso segundo <em>output</em>, com o nome <em>Nome do Container</em>. Em seguida, abriremos o bloco de código para este <em>output</em> com um <em>{</em>.</li>
<li>Na linha 22, faremos algo similar ao que fizemos com o <em>value</em> do output anterior. Utilizaremos interpolação para buscar o valor do atributo <em>name</em>, que faz parte do <em>resource</em> <em>docker_container</em>. Nosso <em>value</em> será: ${docker_container.container_id.name}</li>
<li>Na linha 23, apenas fechamos nosso <em>output</em>.</li>
</ol>


<p><strong>V</strong>amos então rodar nosso <em>plan</em> para ver o que aconteceria desta vez:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">$ terraform plan</span>
</span><span class='line'><span class="l-Scalar-Plain">Refreshing Terraform state in-memory prior to plan...</span>
</span><span class='line'><span class="l-Scalar-Plain">The refreshed state will be used to calculate this plan, but will not be</span>
</span><span class='line'><span class="l-Scalar-Plain">persisted to local or remote state storage.</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">An execution plan has been generated and is shown below.</span>
</span><span class='line'><span class="l-Scalar-Plain">Resource actions are indicated with the following symbols</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">+ create</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Terraform will perform the following actions</span><span class="p-Indicator">:</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">+ docker_container.container_id</span>
</span><span class='line'>      <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span>               <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">attach</span><span class="p-Indicator">:</span>           <span class="s">&quot;false&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">bridge</span><span class="p-Indicator">:</span>           <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">container_logs</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">exit_code</span><span class="p-Indicator">:</span>        <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">gateway</span><span class="p-Indicator">:</span>          <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span>            <span class="s">&quot;${docker_image.image_id.latest}&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ip_address</span><span class="p-Indicator">:</span>       <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ip_prefix_length</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">log_driver</span><span class="p-Indicator">:</span>       <span class="s">&quot;json-file&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">logs</span><span class="p-Indicator">:</span>             <span class="s">&quot;false&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">must_run</span><span class="p-Indicator">:</span>         <span class="s">&quot;true&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>             <span class="s">&quot;supermario&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">network_data.#</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.#</span><span class="p-Indicator">:</span>          <span class="s">&quot;1&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.0.external</span><span class="p-Indicator">:</span> <span class="s">&quot;80&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.0.internal</span><span class="p-Indicator">:</span> <span class="s">&quot;8080&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.0.ip</span><span class="p-Indicator">:</span>       <span class="s">&quot;0.0.0.0&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.0.protocol</span><span class="p-Indicator">:</span> <span class="s">&quot;tcp&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">restart</span><span class="p-Indicator">:</span>          <span class="s">&quot;no&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">rm</span><span class="p-Indicator">:</span>               <span class="s">&quot;false&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">start</span><span class="p-Indicator">:</span>            <span class="s">&quot;true&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">+ docker_image.image_id</span>
</span><span class='line'>      <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span>               <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">latest</span><span class="p-Indicator">:</span>           <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>             <span class="s">&quot;pengbai/docker-supermario:latest&quot;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Plan</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2 to add, 0 to change, 0 to destroy.</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">------------------------------------------------------------------------</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Note</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">You didn&#39;t specify an &quot;-out&quot; parameter to save this plan, so Terraform</span>
</span><span class='line'><span class="l-Scalar-Plain">can&#39;t guarantee that exactly these actions will be performed if</span>
</span><span class='line'><span class="s">&quot;terraform</span><span class="nv"> </span><span class="s">apply&quot;</span> <span class="l-Scalar-Plain">is subsequently run.</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>D</strong>esta vez podemos ver que ambas as ações serão executadas: A imagem será baixada e o container será criado, afinal tínhamos removido tudo com <em>terraform destroy</em> anteriormente.</p>

<p><strong>V</strong>amos aplicar nosso código e confirmar com <em>yes</em>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">$ terraform apply</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">An execution plan has been generated and is shown below.</span>
</span><span class='line'><span class="l-Scalar-Plain">Resource actions are indicated with the following symbols</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">+ create</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Terraform will perform the following actions</span><span class="p-Indicator">:</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">+ docker_container.container_id</span>
</span><span class='line'>      <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span>               <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">attach</span><span class="p-Indicator">:</span>           <span class="s">&quot;false&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">bridge</span><span class="p-Indicator">:</span>           <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">container_logs</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">exit_code</span><span class="p-Indicator">:</span>        <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">gateway</span><span class="p-Indicator">:</span>          <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span>            <span class="s">&quot;${docker_image.image_id.latest}&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ip_address</span><span class="p-Indicator">:</span>       <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ip_prefix_length</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">log_driver</span><span class="p-Indicator">:</span>       <span class="s">&quot;json-file&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">logs</span><span class="p-Indicator">:</span>             <span class="s">&quot;false&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">must_run</span><span class="p-Indicator">:</span>         <span class="s">&quot;true&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>             <span class="s">&quot;supermario&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">network_data.#</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.#</span><span class="p-Indicator">:</span>          <span class="s">&quot;1&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.0.external</span><span class="p-Indicator">:</span> <span class="s">&quot;80&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.0.internal</span><span class="p-Indicator">:</span> <span class="s">&quot;8080&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.0.ip</span><span class="p-Indicator">:</span>       <span class="s">&quot;0.0.0.0&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ports.0.protocol</span><span class="p-Indicator">:</span> <span class="s">&quot;tcp&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">restart</span><span class="p-Indicator">:</span>          <span class="s">&quot;no&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">rm</span><span class="p-Indicator">:</span>               <span class="s">&quot;false&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">start</span><span class="p-Indicator">:</span>            <span class="s">&quot;true&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">+ docker_image.image_id</span>
</span><span class='line'>      <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span>               <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">latest</span><span class="p-Indicator">:</span>           <span class="l-Scalar-Plain">&lt;computed&gt;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>             <span class="s">&quot;pengbai/docker-supermario:latest&quot;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Plan</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2 to add, 0 to change, 0 to destroy.</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Do you want to perform these actions?</span>
</span><span class='line'>  <span class="l-Scalar-Plain">Terraform will perform the actions described above.</span>
</span><span class='line'>  <span class="l-Scalar-Plain">Only &#39;yes&#39; will be accepted to approve.</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">Enter a value</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yes</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">docker_image.image_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Creating...</span>
</span><span class='line'>  <span class="l-Scalar-Plain">latest</span><span class="p-Indicator">:</span> <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;&lt;computed&gt;&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>   <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;pengbai/docker-supermario:latest&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_image.image_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Still creating... (10s elapsed)</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_image.image_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Still creating... (20s elapsed)</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_image.image_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Still creating... (30s elapsed)</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_image.image_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Still creating... (40s elapsed)</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_image.image_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Still creating... (50s elapsed)</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_image.image_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Creation complete after 59s (ID</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sha256:49beaba1c5cc49d2fa424ac03a15b0e7...9c3d62pengbai/docker-supermario:latest)</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_container.container_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Creating...</span>
</span><span class='line'>  <span class="l-Scalar-Plain">attach</span><span class="p-Indicator">:</span>           <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;false&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">bridge</span><span class="p-Indicator">:</span>           <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;&lt;computed&gt;&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">container_logs</span><span class="p-Indicator">:</span>   <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;&lt;computed&gt;&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">exit_code</span><span class="p-Indicator">:</span>        <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;&lt;computed&gt;&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">gateway</span><span class="p-Indicator">:</span>          <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;&lt;computed&gt;&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span>            <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;sha256:49beaba1c5cc49d2fa424ac03a15b0e761f637e835c1ed4d8108cc247a9c3d62&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">ip_address</span><span class="p-Indicator">:</span>       <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;&lt;computed&gt;&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">ip_prefix_length</span><span class="p-Indicator">:</span> <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;&lt;computed&gt;&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">log_driver</span><span class="p-Indicator">:</span>       <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;json-file&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">logs</span><span class="p-Indicator">:</span>             <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;false&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">must_run</span><span class="p-Indicator">:</span>         <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;true&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>             <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;supermario&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">network_data.#</span><span class="p-Indicator">:</span>   <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;&lt;computed&gt;&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">ports.#</span><span class="p-Indicator">:</span>          <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;1&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">ports.0.external</span><span class="p-Indicator">:</span> <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;80&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">ports.0.internal</span><span class="p-Indicator">:</span> <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;8080&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">ports.0.ip</span><span class="p-Indicator">:</span>       <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;0.0.0.0&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">ports.0.protocol</span><span class="p-Indicator">:</span> <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;tcp&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">restart</span><span class="p-Indicator">:</span>          <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;no&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">rm</span><span class="p-Indicator">:</span>               <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;false&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">start</span><span class="p-Indicator">:</span>            <span class="s">&quot;&quot;</span> <span class="l-Scalar-Plain">=&gt; &quot;true&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">docker_container.container_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Creation complete after 0s (ID</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">655604d672af8ff76c10aca4cd169a6aa284dcca17f0e0215374fb18c86660fd)</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Apply complete! Resources</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2 added, 0 changed, 0 destroyed.</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Outputs</span><span class="p-Indicator">:</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Endereco IP = 172.17.0.2</span>
</span><span class='line'><span class="l-Scalar-Plain">Nome do Container = supermario</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>R</strong>epare que tudo o que queríamos foi executado e que, ao final, recebemos duas saídas ou <em>outputs</em>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">Apply complete! Resources</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2 added, 0 changed, 0 destroyed.</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Outputs</span><span class="p-Indicator">:</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">Endereco IP = 172.17.0.2</span>
</span><span class='line'><span class="l-Scalar-Plain">Nome do Container = supermario</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>N</strong>ovamente, se você acessar em seu navegador o endereço <em>localhost:80</em>, ou utilizar os comandos <em>docker ps</em>, perceberá que sua aplicação está novamente rodando.</p>

<p><strong>N</strong>ão é complicado, certo?!</p>

<p><strong>O</strong>bviamente, isto é apenas um exemplo extremamente simplista de uso do Terraform para criar uma pequena infraestrutura como código, o que em nosso caso é apenas um container.</p>

<p><strong>N</strong>o próximo post pretendo alterar um pouco este nosso código para utilizar algumas melhores práticas propostas pelo Terraform, como a utilização de variáveis e outputs em arquivos distintos, já que não utilizamos variáveis neste post.</p>

<p><strong>U</strong>m passo de cada vez, certo?!</p>

<p><strong>H</strong>appy Hacking!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Marcelo Cavalcante Rocha - Kalib</span></span>

      








  


<time datetime="2018-10-29T21:35:00-04:00" pubdate data-updated="true">Oct 29<span>th</span>, 2018</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/cloud/'>Cloud</a>, <a class='category' href='/blog/categories/devops/'>Devops</a>, <a class='category' href='/blog/categories/docker/'>Docker</a>, <a class='category' href='/blog/categories/gcp/'>GCP</a>, <a class='category' href='/blog/categories/sysadmin/'>Sysadmin</a>, <a class='category' href='/blog/categories/terraform/'>Terraform</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="https://twitter.com/share" class="twitter-share-button" data-url="https://kalib.github.io/blog/2018/10/29/introducao-ao-terraform/" data-via="" data-counturl="https://kalib.github.io/blog/2018/10/29/introducao-ao-terraform/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2018/10/22/infraestrutura-como-codigo-com-terraform/" title="Previous Post: Infraestrutura como Código com Terraform">&laquo; Infraestrutura como Código com Terraform</a>
      
      
        <a class="basic-alignment right" href="/blog/2018/11/06/terraform-variaveis-e-outputs/" title="Next Post: Terraform: Variáveis e Outputs">Terraform: Variáveis e Outputs &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1 align="left">Marcelo Cavalcante</h1>
  <p><img class="right" src="https://www.marcelocavalcante.net/imgs/kalib_picture_pq_circle_pq.png" title="'kalib'" ><p align=rght>Engenheiro DevOps dinâmico, escrupulosamente curioso, reservadamente convencional, multitarefa, command line heavy-user, estudante e pesquisador, surfista por prazer, leitor inquieto e apaixonado por vinhos.<br>Me conheça melhor <a href="https://blog.marcelocavalcante.net/about">clicando aqui</a>.</p></p>
</section>
<section>
  <h1>Posts Recentes</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/11/24/terraform-criando-uma-infraestrutura-no-google-cloud/">Terraform: Criando uma infraestrutura no Google Cloud</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/11/06/terraform-variaveis-e-outputs/">Terraform: Variáveis e Outputs</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/10/29/introducao-ao-terraform/">Introdução ao Terraform</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/10/22/infraestrutura-como-codigo-com-terraform/">Infraestrutura como Código com Terraform</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/08/11/criando-uma-imagem-aws-ec2-com-packer-e-puppet/">Criando uma Imagem AWS EC2 com Packer e Puppet</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Estou lendo</h1>
  <img align="center" src="/imgs/livros/outsider.jpg">
</section>
<section>
  <h1> Eu apoio
</h1>
  <span>
    <a href='https://ansible.com'><img style='padding: .5em; margin: .5em;' src='/images/stickers/ansible.com.png'></a><a href='https://archlinux.org'><img style='padding: .5em; margin: .5em;' src='/images/stickers/archlinux.org.png'></a><a href='https://asterisk.org'><img style='padding: .5em; margin: .5em;' src='/images/stickers/asterisk.org.png'></a><a href='https://atom.io'><img style='padding: .5em; margin: .5em;' src='/images/stickers/atom.io.png'></a><a href='https://chef.io'><img style='padding: .5em; margin: .5em;' src='/images/stickers/chef.io.png'></a><a href='https://djangoproject.com'><img style='padding: .5em; margin: .5em;' src='/images/stickers/djangoproject.com.png'></a><a href='https://docker.com'><img style='padding: .5em; margin: .5em;' src='/images/stickers/docker.com.png'></a><a href='https://github.com'><img style='padding: .5em; margin: .5em;' src='/images/stickers/github.com.png'></a><img style='padding: .5em; margin: .5em;' src='/images/stickers/glider.png' ><a href='https://jenkins.io'><img style='padding: .5em; margin: .5em;' src='/images/stickers/jenkins.io.png'></a><a href='https://kde.org'><img style='padding: .5em; margin: .5em;' src='/images/stickers/kde.org.png'></a><a href='https://kubernetes.io'><img style='padding: .5em; margin: .5em;' src='/images/stickers/kubernetes.io.png'></a><a href='https://linux.org'><img style='padding: .5em; margin: .5em;' src='/images/stickers/linux.org.png'></a><a href='https://octopress.org'><img style='padding: .5em; margin: .5em;' src='/images/stickers/octopress.org.png'></a><a href='https://opensource.org'><img style='padding: .5em; margin: .5em;' src='/images/stickers/opensource.org.png'></a><a href='https://packer.io'><img style='padding: .5em; margin: .5em;' src='/images/stickers/packer.io.png'></a><a href='https://puppet.com'><img style='padding: .5em; margin: .5em;' src='/images/stickers/puppet.com.png'></a><a href='https://python.org'><img style='padding: .5em; margin: .5em;' src='/images/stickers/python.org.png'></a><a href='https://raspberrypi.org'><img style='padding: .5em; margin: .5em;' src='/images/stickers/raspberrypi.org.png'></a><a href='https://ruby-lang.org'><img style='padding: .5em; margin: .5em;' src='/images/stickers/ruby-lang.org.png'></a><a href='https://terraform.io'><img style='padding: .5em; margin: .5em;' src='/images/stickers/terraform.io.png'></a><a href='https://vagrantup.com'><img style='padding: .5em; margin: .5em;' src='/images/stickers/vagrantup.com.png'></a>
  </span>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - Marcelo Cavalcante Rocha - Kalib -
  <span class="credit">Powered by <a href="https://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'marcelocavalcante';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'https://kalib.github.io/blog/2018/10/29/introducao-ao-terraform/';
        var disqus_url = 'https://kalib.github.io/blog/2018/10/29/introducao-ao-terraform/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'https://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
